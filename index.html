<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                      "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
	<title>All I want is a million bucks.</title>
	<link
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<link rel="stylesheet" type="text/css" href="site.css">
	<script type="text/javascript" src="jquery-1.7.1.min.js"></script>
        <script type="text/javascript" src="google-jsapi.js"></script>
    </head>

    <body>
	<script type="text/javascript">
	    var dataArray = new Array();

	    function printSum(sum) {
		sum = sum + "";
		var cents = sum.substring(sum.length - 2);
		var euros = sum.substring(0, sum.length - 2);
		return euros + "," + cents;
	    }

	    function refreshData() {
		dataArray = new Array();
		var raw = $("#data").val();
		var lines = raw.split("\n");
		for (i in lines) {
		    if (lines[i]) {
			var lineData = lines[i].split("     ");
			if (lineData.length == 4) {
			    if (lineData[1] == 'Oma siirto') { continue; }
			

			    var sign = lineData[3].substring(lineData[3].length - 1);
			    var sum = lineData[3].substring(0, lineData[3].length - 1);
			    sum = sum.replace(".", "").replace(",", "");
			    sum = parseInt(sum);

			    dateArray = lineData[0].split(".");

			    // new Date(year, month, day, hours, minutes, seconds, milliseconds);
			    dataArray[dataArray.length] = {    'date':new Date(dateArray[2], parseInt(dateArray[1]) - 1, dateArray[0], 0, 0, 0, 0),
							       'type':lineData[1],
							   'location':lineData[2],
								'sum':sum,
							       'sign':sign};
			}
		    }
		}
		dataArray = dataArray.sort( function(a, b) { return a.date-b.date; });
	    }
	    function doThePan() {
		refreshData();
		var tulot = 0;
		var menot = 0;
		for (i in dataArray) {
		    if (dataArray[i].sign == '-') {
			menot += dataArray[i].sum;
		    } else {
			tulot += dataArray[i].sum;
		    }
		}
		$('#tulot').html(printSum(tulot));
		$('#menot').html(printSum(menot));

		$('#content').animate({
		    'width': '900px'
		 }, 700, function() {
		    $('#lines').css('display', 'none');
		    $('#links').css('display', 'block');
		 });
	    }
	    function showTop() {
		drawChart();

		var newMargin = $(window).height() - ($('#content').height() + 32);
		    $('#content').css('border-right', 'solid 1px black');
		$('#content').animate({
		    'margin-top': newMargin + 'px',
		    'margin-right': '50px'
		 }, 700, function() {
		    $('#content').css('border-bottom', '0');
		    $('#links').css('display', 'none');
		    $('#graph').css('display', 'block');
		 });

	    }
	    function showForm() {
		$('#content').animate({
		    'width': '450px'
		 }, 700, function() {
		    $('#links').css('display', 'none');
		    $('#lines').css('display', 'block');
		 });
	    }
	    function showMenu() {
		$('#content').css('border-bottom', 'solid 1px black');
		$('#content').animate({
		    'margin-top': '100px',
		    'margin-right': '0'
		 }, 700, function() {
		    $('#content').css('border-right', '0');
		    $('#graph').css('display', 'none');
		    $('#links').css('display', 'block');
		 });
	    }

	    $(document).ready( function(){
		$('#data').focus();
	    });
	</script>
	<div id="bg"><img src="IMG_0182.JPG" alt=""></div>

	<div id="content">
	    <form id="lines">
		<label>kopioi t&#228;h&#228;n kaikki tilitapahtumat verkkopankista</label><br />
		<textarea id="data" rows="40" cols="60"></textarea>
	    	<br />
		<button onclick="doThePan();return false;">valmis</button>
	    </form>
	    <div id="links" style="display: none;">
		<p>
		    Tulot yhteens&#228;: <span id="tulot"></span><br>
		    Menot yhteens&#228;: <span id="menot"></span>
		</p>
		<p><a href="#" onclick="showTop();return false;">n&#228;yt&#228; menojen kertyminen</a></p>
		<p class="back"><a href="#" onclick="showForm();return false;">korjaa tietoja</a></p>
	    </div>
	    <div id="graph" style="display: none;">
		<script type="text/javascript">
		    google.load("visualization", "1", {packages:["corechart"]});
		    google.setOnLoadCallback(drawChart);
		    function drawChart() {
			var barData = new google.visualization.DataTable();
			barData.addColumn('string', 'pvm');
			barData.addColumn('number', 'menot');

			var dateString = '';
			var dailyExpensesTotal = 0.00;
			var allExpensesTotal = 0;
			var dailyExpensesString = '';
			for (i in dataArray) {
			    if (dataArray[i].sign == '+') { continue; }
			    var day = "" + dataArray[i].date.getDate();
			    if (dateString != day) {
				allExpensesTotal += dailyExpensesTotal;
				if (dateString != '') { barData.addRow([dateString + ".", {f: "yhteens" + String.fromCharCode(228) + ": " + printSum(dailyExpensesTotal) + "\n" + dailyExpensesString, 
											   v: allExpensesTotal / 100}]); }
				
				dateString = day;
				dailyExpensesTotal = 0;
				dailyExpensesString = '';

			    }
			    
			    dailyExpensesTotal += dataArray[i].sum;
			    if (dataArray[i].location == '') {
				dailyExpensesString += dataArray[i].type + " " + printSum(dataArray[i].sum) + "\n";
			    } else {
				dailyExpensesString += dataArray[i].location + " " + printSum(dataArray[i].sum) + "\n";
			    }
			}
			if (dateString != '') { barData.addRow([dateString + ".", {f: "yhteens" + String.fromCharCode(228) + ": " + printSum(dailyExpensesTotal) + "\n" + dailyExpensesString, 
										   v: (dailyExpensesTotal + allExpensesTotal) / 100}]); }

			var barOptions = {
			    title: 'Menot',
			    hAxis: {title: 'p' + String.fromCharCode(228) + 'iv' + String.fromCharCode(228), titleTextStyle: {color: 'red'}},
			    vAxis: {minValue: 0},
			    width: 900,
			    height: 500
			};

			var barChart = new google.visualization.ColumnChart(document.getElementById('bar_chart_div'));
			barChart.draw(barData, barOptions);
		    }
    
		</script>
		<div id="bar_chart_div" style="width: 900px; height: 500px;"></div>
	

		<p class="back_from_bar_chart"><a href="#" onclick="showMenu();return false;">takaisin</a></p>
	    </div>
	</div>
    </body>
</html>

